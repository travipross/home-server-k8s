image:
  repository: ghcr.io/blakeblackshear/frigate
  tag: 0.16.3
  pullPolicy: IfNotPresent
strategyType: Recreate

# -- additional ENV variables to set. Prefix with FRIGATE_ to target Frigate configuration values
env:
  FRIGATE_MQTT_USER: ""
  FRIGATE_MQTT_PASSWORD: ""
  # TZ: UTC

# -- set environment variables from Secret(s)
envFromSecrets: []
  # secrets are required before `helm install`
  # - frigate-rstp-credentials

coral:
  # -- enables the use of a Coral device
  enabled: false
  # -- path on the host to which to mount the Coral device
  hostPath: /dev/bus/usb

# Add the Intel GPU device pass-through (have to use volume mount because chart doesn't support `devices`)
extraVolumes:
  - name: dev-dri
    hostPath:
      path: /dev/dri
extraVolumeMounts:
  - name: dev-dri
    mountPath: /dev/dri
    readOnly: false

# SHM is used for raw video frames. 1Gi is safe for ~4-5 high-res cameras.
shmSize: 1.5Gi

# tmpfs is used for recording segments before they go to Longhorn.
tmpfs:
  enabled: true
  sizeLimit: 1.5Gi

# Overridden with configMap contents via HelmRelease.spec.valuesFrom
config: |
  # https://docs.frigate.video/configuration/object_detectors/#openvino-detector
  detectors:
    ov:
      type: openvino
      device: GPU

  # Hardware acceleration
  ffmpeg:
    hwaccel_args: preset-vaapi

  # https://docs.frigate.video/configuration/object_detectors/#supported-models
  # https://docs.frigate.video/configuration/object_detectors/#ssdlite-mobilenet-v2
  model:
    width: 300
    height: 300
    input_tensor: nhwc
    input_pixel_format: bgr
    path: /openvino-model/ssdlite_mobilenet_v2.xml
    labelmap_path: /openvino-model/coco_91cl_bkgr.txt

  # Cameras currently sourced from primary frigate server's go2rtc restreams
  cameras:
    doorbell:
      ffmpeg:
        inputs:
          - path: rtsp://192.168.2.100:8554/doorbell_sub
            roles:
              - detect
      motion:
        mask: "0.001,0.057,0.576,0.061,0.576,0.002,0,0"
    driveway:
      ffmpeg:
        inputs:
          - path: rtsp://192.168.2.100:8554/driveway_sub
            roles:
              - detect
      motion:
        mask: "0,0.055,0.363,0.057,0.362,0,0,0"
    garage:
      ffmpeg:
        inputs:
          - path: rtsp://192.168.2.100:8554/garage_sub
            roles:
              - detect
      motion:
        mask: "0,0.066,0.334,0.06,0.335,0,0,0"
    catio:
      ffmpeg:
        inputs:
          - path: rtsp://192.168.2.100:8554/catio_sub
            roles:
              - detect
      motion:
        mask: "0,0.065,0.373,0.069,0.375,0,0,0.004"
    back_yard:
      ffmpeg:
        inputs:
          - path: rtsp://192.168.2.100:8554/back_yard_sub
            roles:
              - detect
      motion:
        mask: "0,0.059,0.36,0.059,0.362,0.004,0,0.001"
    cat_ptz:
      ffmpeg:
        inputs:
          - path: rtsp://192.168.2.100:8554/cat_ptz_sub
            roles:
              - detect
      motion:
        mask: "0,0.054,0.363,0.053,0.362,0,0,0.004"
    living_room:
      ffmpeg:
        inputs:
          - path: rtsp://192.168.2.100:8554/living_room_sub
            roles:
              - detect
      motion:
        mask: "0,0.065,0.365,0.069,0.365,0,0,0"

  mqtt:
    host: mosquitto

  # Disable TLS as Frigate will be hosted behind a reverse proxy / ingress
  tls:
    enabled: false

  # Enable detection for benchmarking
  detect:
    enabled: true

  # Enable recording to media dir
  record:
    enabled: true

  # Generated by frigate for config migrations - Do not edit
  version: 0.16-0

service:
  type: ClusterIP
  port: 5000
  labels:
    app: frigate

ingress:
  enabled: true
  ingressClassName: traefik
  hosts:
    - host: frigate.home-server-k3s.lan
      paths:
        - path: "/"
          # portName: http-auth
          portName: http
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web

persistence:
  # use init container to copy config from configMap over to PVC at startup
  config:
    enabled: true
    existingClaim: frigate-appconfig
    accessMode: ReadWriteOnce
    size: 1Gi
    skipuninstall: true # Requires manual deletion of PVC if desired
    ephemeralWritableConfigYaml: true # so that migrations can be run and UI editor can be used

  media:
    enabled: true
    existingClaim: frigate-media
    size: 10Gi
    skipuninstall: true # Requires manual deletion of PVC if desired

# Resource limits to ensure pod doesn't crash k8s control plane
resources:
  limits:
    cpu: "3200m"
    memory: "6Gi"
  requests:
    cpu: "500m"
    memory: "2Gi"

# Enable privileged mode so Frigate can talk to the GPU
securityContext:
  privileged: true
